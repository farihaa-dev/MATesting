<!doctype html>
<html lang="en">
<head>

  <meta charset="utf-8" />
  <title>Mastercard Click to Pay - Minimal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

     <!-- Adding Content Security Policy   
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://sandbox.src.mastercard.com; object-src 'none'; base-uri 'self';">
-->

  
  <!-- Mastercard Click to Pay (Sandbox) -->
 <script 
src="https://sandbox.src.mastercard.com/sdk/srcsdk.mastercard.js">
</script>


    <!--Adding required scripts for SRC Button-->
  <script type="module" src="https://src.mastercard.com/srci/integration/components/src-ui-kit/src-ui-kit.esm.js"></script>
<link rel="stylesheet" href="https://src.mastercard.com/srci/integration/components/src-ui-kit/src-ui-kit.css">

  
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }
    .row { margin: 12px 0; }
    button { padding: 10px 16px; font-size: 16px; }
    pre { background: #f6f8fa; padding: 12px; overflow: auto; }
    input { padding: 8px; font-size: 16px; width: 280px; }
  </style>
</head>
<body>
  <h1>Mastercard Click to Pay (Sandbox)</h1>

  <div class="row">
    <label for="email">Consumer email (sandbox profile):</label><br />
    <input id="email" type="email" placeholder="consumer@example.com" />
  </div>

  <div class="row">
    <button id="ctpButton" type="button">Click to Pay</button>
  </div>

  <div class="row">
    <strong>Logs</strong>
    <pre id="log"></pre>
  </div>

  <script>
    const logEl = document.getElementById('log');
    function log(msg, data) {
      const line = typeof data === 'undefined' ? msg : msg + ' ' + JSON.stringify(data, null, 2);
      logEl.textContent += line + '\n';
      console.log(msg, data);
    }

    // Replace these with YOUR sandbox config
    const DPA_ID = '576094b8-e60d-48c7-babe-0a1e0611b37e';
    const MERCHANT_COUNTRY = 'AU'; // your merchant country
    const CURRENCY = 'AUD';
    const AMOUNT = '100.00';

 /**   async function initClickToPay() {
      if (!window.mcCheckoutServices) {
        throw new Error('ClickToPay SDK not loaded. Check script URL.');
      }
      // Some setups use dpaId; others srcInitiatorId. Use the one assigned to you.
      const initOptions = {
          srcDpaId: "576094b8-e60d-48c7-babe-0a1e0611b37e",
            dpaData: {
                dpaName: "DPA Name"
            },
            dpaTransactionOptions: {
                dpaLocale: "en_US"
            },
            cardBrands: ["mastercard"]
      }; 
      log('Calling click2pay.init', initOptions);
      await window.mcCheckoutServices.init(initOptions);
      log('ClickToPay.init done');**/
      init(initOptions);
    }

 /*   async function runClickToPay() {
      try {
        await initClickToPay();

        const email = document.getElementById('email').value.trim();
        if (!email) {
          alert('Enter a sandbox consumer email that has Click to Pay set up.');
          return;
        }*/

        // 1) Check if consumer is recognized
        log('Calling SRC.isRecognized', { email });
        const recognized = await window.mcCheckoutServices.isRecognized({
          consumer: { emailAddress: email }
        });
        log('isRecognized response', recognized);

        // 2) If not recognized, identify consumer (may send OTP/password)
        if (!recognized || recognized.consumerRecognized !== true) {
          log('Calling click2pay.identify');
          await window.mcCheckoutServices.identify({
            consumer: { emailAddress: email }
          });
          log('SRC.identify done');
        }

        // 3) Start checkout flow. You can let SDK prompt card selection.
        const paymentRequest = {
          amount: '100.00',
          currencyCode: 'AUD',
          countryCode: 'AU'
        };

        log('Calling SRC.checkout', paymentRequest);
        const result = await window.mcCheckoutServices.checkout({
          windowRef: window,     // or a popup; SDK decides the UI
          paymentRequest
        });

        // 4) Send result/token/cryptogram to your server to authorize
        log('Checkout result', result);
      } catch (err) {
        log('Error', { message: err?.message || String(err) });
        alert('Click to Pay error: ' + (err?.message || String(err)));
      }
    }

    document.getElementById('ctpButton').addEventListener('click', runClickToPay);
  </script>
</body>
</html>
